<!DOCTYPE html>
<html style="font-size: 16px;">
	<head>
		<meta charset="utf-8">
		<title></title>
		<style>
			html,body{
				margin: 0;
				padding: 0;
				width: 100vw;
				height: auto;
				overflow-x: hidden;
				overflow-y: scroll;
			}
            @media screen and (max-width:1080px){
             *{
                 font-size: 0.25rem;
             }
            }
			.top{
                padding: 0.6rem 0 0 0.6rem;
                width: 100vw;
                
			}
            input{
                min-height: 50px;
            }
			.input{
				width: 2rem !important;
				height: 0.53rem;
                min-width: 200px;
				margin-right: 0.133rem;
				
			}
			.button{
				margin: 0 0.4rem 0.26rem 0 !important;
			}
		</style>
        <script>
            /*  淘宝rem解决方案
                px 转化换 rem ，转化是 10 。
                比如：
                你的设计图为750，那么就 750 / 75 = 10 rem。
                设计图中你量尺寸都要除 75 就是 rem值。再比如量的设计图按钮宽度 66px，那么计算：66 / 75 = 0.88rem
                比如2：
                设计图为900，那么 900 / 90 = 10rem;
                设计图中所有量的尺寸都得除 90 就等于 rem的之。
                以此类推
            */
        
            (function flexible(window, document) {
                var docEl = document.documentElement
                var dpr = window.devicePixelRatio || 1
        
                // adjust body font size
                function setBodyFontSize() {
                    if (document.body) {
                        document.body.style.fontSize = (12 * dpr) + 'px'
                    } else {
                        document.addEventListener('DOMContentLoaded', setBodyFontSize)
                    }
                }
                setBodyFontSize();
        
                // set 1rem = viewWidth / 10
                function setRemUnit() {
                    var rem = docEl.clientWidth / 10
                    docEl.style.fontSize = rem + 'px'
                }
        
                setRemUnit()
        
                // reset rem unit on page resize
                window.addEventListener('resize', setRemUnit)
                window.addEventListener('pageshow', function(e) {
                    if (e.persisted) {
                        setRemUnit()
                    }
                })
        
                // detect 0.5px supports
                if (dpr >= 2) {
                    var fakeBody = document.createElement('body')
                    var testElement = document.createElement('div')
                    testElement.style.border = '.5px solid transparent'
                    fakeBody.appendChild(testElement)
                    docEl.appendChild(fakeBody)
                    if (testElement.offsetHeight === 1) {
                        docEl.classList.add('hairlines')
                    }
                    docEl.removeChild(fakeBody)
                }
            }(window, document))
        </script>
		<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
		<!-- 引入样式 -->
		<link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
		<!-- 引入组件库 -->
		<script src="https://unpkg.com/element-ui/lib/index.js"></script>
		<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
		<script src="https://cdn.staticfile.org/echarts/4.3.0/echarts.min.js"></script>
	</head>
	<body>
		<div class="top">
			<div id="app">
				<div style="display: flex;flex-direction: row;flex-wrap: wrap;justify-content: flex-start;">
					<el-select v-model.lazy="code" class="input"  @keyup.native="elSelectChange" filterable placeholder="请选择">
						<el-option
						  v-for="item in fundNameOptions"
						  :key="item[0]"
						  :label="item[2]"
						  :value="item[0]">
						</el-option>
					</el-select>
					<el-input class="input" v-model="code" @change="inputChange" placeholder="请输入基金代码"></el-input>
					<el-button class="button"  @click="fund" type="primary" plain>查询</el-button>
					<el-button class="button" @click="compute()" type="primary" plain>计算收益</el-button>
					<el-button class="button" @click="dialog = true" type="primary" plain>设置规则</el-button>
					<el-button class="button" @click="clearLocal" type="primary" plain>清除缓存</el-button>
                    <el-button class="button" @click="history" type="primary" plain>历史记录</el-button>
				</div>
				<el-row :gutter="24" style="margin: 0.133rem 0 0 0.133rem;">
                    投入+收益:{{CapitalPool|capitalize}} ; 
                    手续费：{{ServiceCharge|capitalize}} ; 
                    累计收益：{{profit|capitalize}} ; 
                    持有收益：{{holdProfit|capitalize}} ;
                    收益率：{{(profit/CapitalPool*100).toFixed(2)}}%
				</el-row>
				<el-row :gutter="24" style="margin-top: 0.26rem;">
                  <div id="main" style="width: 90vw;height:5.33rem;margin-bottom: 0.133rem;margin: 0;"></div>
                  <el-pagination :page-size="pageCount" :page-sizes="[5, 10, 15, 20, 25, 30, 35, 40, 50, 100, 200, 500, 1000, 2000, 4000, 8000]" :total="dataList.length"
                    @current-change="handleCurrentChange" @size-change="handleSizeChange" background
                    layout="total, prev, pager, next, sizes" ></el-pagination>
				</el-row>
                <el-row :gutter="24" style="margin-top: 0.26rem;"><!-- 基金净值走势 -->
                    <div id="Data_ACWorthTrend" style="width: 90vw;height:6.66rem;margin-bottom: 0.133rem;margin: 0;"></div>
                </el-row>
				<el-row :gutter="24" style="margin-top: 0.26rem;">
					 <!-- 实时净值 -->
					<div id="netWorth" style="width: 90vw;height:6.66rem;margin-bottom: 0.133rem;margin: 0;"></div>
				</el-row>
				<el-row :gutter="24" style="margin: 0.133rem 0 0 0.133rem;">
					<el-col :span="24" style="display: flex;align-items: center;">
					    <div id="">
					       选择年份： 
					    </div>
					    <el-select @change="yearsChange" style="width: 1.6rem;" v-model="yearsValue" placeholder="请选择年份">
					      <el-option
					        v-for="(item,index) in yearsOption"
					        :key="item"
					        :label="item"
					        :value="index">
					      </el-option>
					    </el-select>
					</el-col>
				</el-row>
                <el-row :gutter="24" style="margin-top: 0.26rem;">
                    <el-col :span="18"><!-- 持仓分布 -->
                        <div id="Data_assetAllocation" style="width: 90vw;height:6.66rem;margin-bottom: 0.133rem;margin: 0;"></div>
                    </el-col>
                </el-row>
				
                <el-drawer
                  title="设置交易规则"
                  :visible.sync="dialog"
                  direction="ltr"
                  custom-class="demo-drawer"
                  ref="drawer"
                  size="50%"
                  >
                  <div class="demo-drawer__content">
                    <el-form :model="form" label-width="1.06rem">
                      <el-form-item label="初始资金:">
                        <el-input-number :controls="false" class="input" v-model="form.InitialFunding" autocomplete="off"></el-input-number>
                      </el-form-item>
                      <el-form-item label="买入费率:">
                        <el-input-number :controls="false" class="input" v-model="form.BuyingRate" autocomplete="off"></el-input-number>%
                      </el-form-item>
                      <el-form-item label="卖出费率:">
                        <el-input-number :controls="false" class="input" v-model="form.SellingRate" autocomplete="off"></el-input-number>%
                      </el-form-item>
                      
                      <el-form-item label="连涨卖出:">
                        <el-select v-model="form.PriceIncrease" placeholder="请选连涨几天卖出？">
                            <el-option label="0天" :value="0"></el-option>
                            <el-option v-for="(item,index) in 150" :key="index" :label="item+'天'" :value="item"></el-option>
                        </el-select>
                      </el-form-item>
                      <el-form-item label="涨幅达到:">
                        <el-input-number :controls="false" class="input" v-model="form.IncreaseRate" autocomplete="off"></el-input-number>%(累计连续)
                      </el-form-item>
                      <el-form-item label="卖出金额:">
                        <el-input-number :controls="false" class="input" v-model="form.sellOut" autocomplete="off"></el-input-number>元
                      </el-form-item>
                      
                      <el-form-item label="连跌买入:">
                        <el-select v-model="form.FallingPrice" placeholder="请选连跌几天买入？">
                            <el-option label="0天" :value="0"></el-option>
                            <el-option v-for="(item,index) in 150" :key="index" :label="item+'天'" :value="item"></el-option>
                        </el-select>
                      </el-form-item>
                      <el-form-item label="跌幅达到:">
                        <el-input-number :controls="false" class="input" v-model="form.DeclineRange" autocomplete="off"></el-input-number>%(累计连续)
                      </el-form-item>
                      <el-form-item label="买入金额:">
                        <el-input-number :controls="false" class="input" v-model="form.purchase" autocomplete="off"></el-input-number>元
                      </el-form-item>
                      
                    </el-form>
                    <div class="demo-drawer__footer" style="width: 100%;text-align: center;">
                      <el-button type="primary" @click="dialog = false" >确定</el-button>
                    </div>
                  </div>
                </el-drawer>
                
                <el-drawer
                  title="历史记录"
                  :visible.sync="showHistory"
                  direction="rtl"
                  size="60%">
                   <el-table :data="historyData" stripe height="85vh">
                      <el-table-column property="item[2]" label="基金名称" width="200"></el-table-column>
                      <el-table-column property="code" label="基金代码" width="130"></el-table-column>
                      <el-table-column property="time" label="日期" width="180"></el-table-column>
                      <el-table-column property="address" label="操作">
                           <template slot-scope="scope">
                                  <el-button @click="handleClick(scope.row)" type="text" size="small">查看</el-button>
                                  <el-button @click="delHistory(scope.row)" type="text" size="small">删除</el-button>
                                </template>
                      </el-table-column>
                    </el-table>
                </el-drawer>
                
			</div>
		</div>
		<script src="../../js/public.js"></script>
		<script>
			var app = new Vue({
			  el: '#app',
			  data: {
				host:topurl,
				code:'001186',
				fundNameOptions:[],
				allFundName:[],
				dataList:[],
				curPage: 1,//当前页数
				pageCount: 500,//每页条数
                dialog:false,
                showHistory:false,
                historyData: [],//历史查询数据
                form:{
                    InitialFunding:1000,//初始本金
                    BuyingRate:0.1,//买入费率
                    SellingRate:0.75,//卖出费率
                    PriceIncrease:0,//连涨几超天卖出
                    IncreaseRate:10,//净值估算涨幅%
                    sellOut:100,//卖出金额
                    FallingPrice:0,//连跌超几天买入
                    DeclineRange:2,//净值估算跌幅%
                    purchase:100,//买入金额
                },
                CapitalPool:1000,//资金池，累计投入资金
                ServiceCharge:0,//累计手续费
                profit:0,//累计收益
                holdProfit:0,//持有收益
                Data_ACWorthTrend:[],//净值走势
                Data_assetAllocation:[],//资产分布
                yearsOption: [],
                yearsValue: 3,
                loading:''
			  },
              filters: {
                capitalize: function (value) {
                  if (!value) return 0
                  if(value<10000) return value.toFixed(2) + '元'
                  if(value>=10000) return (value/10000).toFixed(2) + '万元'
                }
              },
			  mounted() {
				  this.getAllFundName()
			  },
			  methods:{
				  handleCurrentChange(curPage) {
				    this.curPage = curPage
					let data = this.dataList.slice((this.curPage-1)*this.pageCount, ((this.curPage-1)*this.pageCount+this.pageCount))
					this.compute(data)
					this.getNetWorth()
				  },
				  handleSizeChange(pageCount) {
					this.pageCount = pageCount
					let data = this.dataList.slice((this.curPage-1)*this.pageCount, ((this.curPage-1)*this.pageCount+this.pageCount))
					this.compute(data)
					this.getNetWorth()
				  },
				  async fund(){
                     this.openLoading()
					let obj = localStorage.getItem(this.code)
					this.getNetWorth()
                    let history = localStorage.getItem('history')
                    let t = new Date()
                    if(history){
                        history = JSON.parse(history)
                        history.unshift({
                            code:this.code,
                            time:t.getFullYear() + '-' + (t.getMonth()+1) + '-' + t.getDate() +' '+ t.getHours()+':'+ t.getMinutes()+':'+ t.getSeconds(),
                            item:this.allFundName.find((item, index)=>{
                                if(item[0] == this.code) return item
                            }),
                        })
                    }else{
                        history = [
                            {
                                code:this.code,
                                time:t.getFullYear() + '-' + (t.getMonth()+1) + '-' + t.getDate() +' '+ t.getHours()+':'+ t.getMinutes()+':'+ t.getSeconds(),
                                item:this.allFundName.find((item, index)=>{
                                    if(item[0] == this.code) return item
                                }),
                            }
                        ]
                    }
                    localStorage.setItem('history',JSON.stringify(history))
					if(obj){
						this.dataList = JSON.parse(obj).data
						this.setLineChart(this.dataList)
                        this.Data_assetAllocation = JSON.parse(obj).Data_assetAllocation
                        this.assetAllocation(this.Data_assetAllocation)
                        this.Data_ACWorthTrend = JSON.parse(obj).Data_ACWorthTrend
                        this.ACWorthTrend(this.Data_ACWorthTrend)
						this.loading.close();
						return
					}
					axios.post(this.host+'/fund/fund',{code:this.code},{timeout:20000})
				   .then((res)=>{
					   this.loading.close();
					   let result = res.data
                       this.Data_assetAllocation = result.Data_assetAllocation //资产分布
                       this.Data_ACWorthTrend = result.Data_ACWorthTrend = result.Data_ACWorthTrend.map((item, index, array)=> { //净值走势
                           let Time = new Date(item[0])
							return {
                                name:Time.getFullYear() + '-' + (Time.getMonth()+1) + '-' + Time.getDate(),
                                value:item[1]
                            }
                       });
					   let data = []
					   result.data.forEach((item,index)=>{ //估算涨幅
						 let Time = new Date(item.x)
						 let nowTime = Time.getFullYear() + '-' + (Time.getMonth()+1) + '-' + Time.getDate()
						 data.push({
							 time:nowTime,
							 num:item.equityReturn
						 })
						 if(index >= (result.data.length-1)){
							 this.dataList = data
							 let arr = this.dataList.slice((this.curPage-1)*this.pageCount, ((this.curPage-1)*this.pageCount+this.pageCount))
							 this.setLineChart(arr)
                             
							 localStorage.setItem(this.code,JSON.stringify({
                                 data,
                                 Data_assetAllocation:result.Data_assetAllocation,
                                 Data_ACWorthTrend:result.Data_ACWorthTrend
                             }))
							} 
					   })
                       this.ACWorthTrend(this.Data_ACWorthTrend)
                       this.assetAllocation(this.Data_assetAllocation)
				   }).catch(()=>{
					   this.loading.close();
				   })
				  },
                  compute(dataList){
                      if(!dataList) dataList = this.dataList.slice((this.curPage-1)*this.pageCount, ((this.curPage-1)*this.pageCount+this.pageCount))
                      let data = []
                      let RisingDays = 0 //上涨天数
                      let FallDays = 0 //下跌天数
                      let RangeRiseFall = 0 //涨跌幅度
                      let CapitalPool = this.form.InitialFunding//投入本金+收益
                      let ServiceCharge = this.form.InitialFunding*this.form.BuyingRate/100 //累计手续费
                      let profit = -this.form.InitialFunding*this.form.BuyingRate/100 //累计收益
                      let holdProfit = profit //持有收益
                      dataList.forEach((item,index,arr)=>{
                           let todayProfit = CapitalPool*item.num/100 //今日盈利
                           profit = profit + todayProfit
                           holdProfit = holdProfit + todayProfit
                          if(item.num > 0){  //今天估算为上涨
                              RisingDays = RisingDays + 1
                              FallDays = 0
							  if(RangeRiseFall<0) RangeRiseFall = 0
							  RangeRiseFall = RangeRiseFall + item.num
							  
                              if(( RisingDays >= this.form.PriceIncrease ) && RangeRiseFall > this.form.IncreaseRate && CapitalPool > 0 ){ //超过设定的连续上涨，则卖出(收益要大于0)
								  let sellOut = this.form.sellOut * RisingDays //卖出金额
                                  let shouXuFei = sellOut * this.form.SellingRate/100  //卖出手续费
                                  CapitalPool = CapitalPool - sellOut + todayProfit//资金池
                                  ServiceCharge = ServiceCharge +  shouXuFei//卖出手续费
                                  profit = profit -  shouXuFei //计算今天盈利
                                  holdProfit = holdProfit - holdProfit*(sellOut/CapitalPool)  -  shouXuFei //持有收益
                                  RangeRiseFall = 0
                                  
                                  console.log("---上涨卖出"+sellOut+'元')
                              }
                          }else if(item.num == 0){ //今天估算不涨不跌
                              
                          }else if(item.num < 0){ //今天估算为下跌
                              FallDays = FallDays + 1
                              RisingDays = 0
							  if(RangeRiseFall>0) RangeRiseFall = 0
							  RangeRiseFall = RangeRiseFall + item.num
							  if( FallDays >= this.form.FallingPrice && RangeRiseFall < -this.form.DeclineRange   ){ //超过设定的连续下跌，则买入
								  let buy = this.form.purchase * FallDays //买入多少钱,连续下跌加倍买入
                                  let shouXuFei = this.form.purchase*this.form.BuyingRate/100 //买入手续费
                                  CapitalPool = CapitalPool + buy - todayProfit//资金池
                                  ServiceCharge = ServiceCharge +  shouXuFei //买入手续费
                                  profit = profit - shouXuFei //计算今天盈利
                                  holdProfit = holdProfit - holdProfit*(buy/CapitalPool) - shouXuFei //持有收益
                                  RangeRiseFall = 0
                                  
                                  console.log("---下跌买入"+buy+'元')
                              }
                          }
                          data.push({
                              num:profit.toFixed(2),
                              time:item.time
                          })
                          if(index >= (arr.length-1)){//结束生成图表
                            this.CapitalPool = CapitalPool
                            this.ServiceCharge = ServiceCharge
                            this.profit = profit
                            this.holdProfit = holdProfit
                            this.setLineChart(data)
                          }
                      })
                  },
				  getNetWorth(){//获取实时净值
					  axios.post(this.host+'/fund/getRealTime',{code:this.code})
					  .then((res)=>{
						  this.setNetWorth(res.data.data.dwjz)
					  })
				  },
				  setNetWorth(value){ //实时净值
					  var myChart = echarts.init(document.getElementById('netWorth'));
					   let angle = 0; //角度，用来做简单的动画效果的
					   var timerId;
					   option = {
					       backgroundColor: '#000E1A',
					       title: {
					           text: '{a|' + value + '}',
					           x: 'center',
					           y: 'center',
					           textStyle: {
					               rich: {
					                   a: {
					                       fontSize: 48,
					                       color: '#29EEF3'
					                   },
					  
					                   c: {
					                       fontSize: 20,
					                       color: '#ffffff',
					                       // padding: [5,0]
					                   }
					               }
					           }
					       },
					  
					       series: [
					           // 紫色
					           {
					               name: "ring5",
					               type: 'custom',
					               coordinateSystem: "none",
					               renderItem: function(params, api) {
					                   return {
					                       type: 'arc',
					                       shape: {
					                           cx: api.getWidth() / 2,
					                           cy: api.getHeight() / 2,
					                           r: Math.min(api.getWidth(), api.getHeight()) / 2 * 0.6,
					                           startAngle: (0 + angle) * Math.PI / 180,
					                           endAngle: (90 + angle) * Math.PI / 180
					                       },
					                       style: {
					                           stroke: "#8383FA",
					                           fill: "transparent",
					                           lineWidth: 1.5
					                       },
					                       silent: true
					                   };
					               },
					               data: [0]
					           }, {
					               name: "ring5", //紫点
					               type: 'custom',
					               coordinateSystem: "none",
					               renderItem: function(params, api) {
					                   let x0 = api.getWidth() / 2;
					                   let y0 = api.getHeight() / 2;
					                   let r = Math.min(api.getWidth(), api.getHeight()) / 2 * 0.6;
					                   let point = getCirlPoint(x0, y0, r, (90 + angle))
					                   return {
					                       type: 'circle',
					                       shape: {
					                           cx: point.x,
					                           cy: point.y,
					                           r: 4
					                       },
					                       style: {
					                           stroke: "#8450F9", //绿
					                           fill: "#8450F9"
					                       },
					                       silent: true
					                   };
					               },
					               data: [0]
					           },
					           // 蓝色
					  
					           {
					               name: "ring5",
					               type: 'custom',
					               coordinateSystem: "none",
					               renderItem: function(params, api) {
					                   return {
					                       type: 'arc',
					                       shape: {
					                           cx: api.getWidth() / 2,
					                           cy: api.getHeight() / 2,
					                           r: Math.min(api.getWidth(), api.getHeight()) / 2 * 0.6,
					                           startAngle: (180 + angle) * Math.PI / 180,
					                           endAngle: (270 + angle) * Math.PI / 180
					                       },
					                       style: {
					                           stroke: "#4386FA",
					                           fill: "transparent",
					                           lineWidth: 1.5
					                       },
					                       silent: true
					                   };
					               },
					               data: [0]
					           },
					           {
					               name: "ring5", // 蓝色
					               type: 'custom',
					               coordinateSystem: "none",
					               renderItem: function(params, api) {
					                   let x0 = api.getWidth() / 2;
					                   let y0 = api.getHeight() / 2;
					                   let r = Math.min(api.getWidth(), api.getHeight()) / 2 * 0.6;
					                   let point = getCirlPoint(x0, y0, r, (180 + angle))
					                   return {
					                       type: 'circle',
					                       shape: {
					                           cx: point.x,
					                           cy: point.y,
					                           r: 4
					                       },
					                       style: {
					                           stroke: "#4386FA", //绿
					                           fill: "#4386FA"
					                       },
					                       silent: true
					                   };
					               },
					               data: [0]
					           },
					  
					           {
					               name: "ring5",
					               type: 'custom',
					               coordinateSystem: "none",
					               renderItem: function(params, api) {
					                   return {
					                       type: 'arc',
					                       shape: {
					                           cx: api.getWidth() / 2,
					                           cy: api.getHeight() / 2,
					                           r: Math.min(api.getWidth(), api.getHeight()) / 2 * 0.65,
					                           startAngle: (270 + -angle) * Math.PI / 180,
					                           endAngle: (40 + -angle) * Math.PI / 180
					                       },
					                       style: {
					                           stroke: "#0CD3DB",
					                           fill: "transparent",
					                           lineWidth: 1.5
					                       },
					                       silent: true
					                   };
					               },
					               data: [0]
					           },
					           // 橘色
					  
					           {
					               name: "ring5",
					               type: 'custom',
					               coordinateSystem: "none",
					               renderItem: function(params, api) {
					                   return {
					                       type: 'arc',
					                       shape: {
					                           cx: api.getWidth() / 2,
					                           cy: api.getHeight() / 2,
					                           r: Math.min(api.getWidth(), api.getHeight()) / 2 * 0.65,
					                           startAngle: (90 + -angle) * Math.PI / 180,
					                           endAngle: (220 + -angle) * Math.PI / 180
					                       },
					                       style: {
					                           stroke: "#FF8E89",
					                           fill: "transparent",
					                           lineWidth: 1.5
					                       },
					                       silent: true
					                   };
					               },
					               data: [0]
					           }, {
					               name: "ring5",
					               type: 'custom',
					               coordinateSystem: "none",
					               renderItem: function(params, api) {
					                   let x0 = api.getWidth() / 2;
					                   let y0 = api.getHeight() / 2;
					                   let r = Math.min(api.getWidth(), api.getHeight()) / 2 * 0.65;
					                   let point = getCirlPoint(x0, y0, r, (90 + -angle))
					                   return {
					                       type: 'circle',
					                       shape: {
					                           cx: point.x,
					                           cy: point.y,
					                           r: 4
					                       },
					                       style: {
					                           stroke: "#FF8E89", //粉
					                           fill: "#FF8E89"
					                       },
					                       silent: true
					                   };
					               },
					               data: [0]
					           }, {
					               name: "ring5", //绿点
					               type: 'custom',
					               coordinateSystem: "none",
					               renderItem: function(params, api) {
					                   let x0 = api.getWidth() / 2;
					                   let y0 = api.getHeight() / 2;
					                   let r = Math.min(api.getWidth(), api.getHeight()) / 2 * 0.65;
					                   let point = getCirlPoint(x0, y0, r, (270 + -angle))
					                   return {
					                       type: 'circle',
					                       shape: {
					                           cx: point.x,
					                           cy: point.y,
					                           r: 4
					                       },
					                       style: {
					                           stroke: "#0CD3DB", //绿
					                           fill: "#0CD3DB"
					                       },
					                       silent: true
					                   };
					               },
					               data: [0]
					           }, {
					               name: '吃猪肉频率',
					               type: 'pie',
					               radius: ['52%', '40%'],
					               silent: true,
					               clockwise: true,
					               startAngle: 90,
					               z: 0,
					               zlevel: 0,
					               label: {
					                   normal: {
					                       position: "center",
					  
					                   }
					               },
					               data: [{
					                       value: value,
					                       name: "",
					                       itemStyle: {
					                           normal: {
					                               color: { // 完成的圆环的颜色
					                                   colorStops: [{
					                                           offset: 0,
					                                           color: '#A098FC' // 0% 处的颜色
					                                       },
					                                       {
					                                           offset: 0.3,
					                                           color: '#4386FA' // 0% 处的颜色
					                                       },
					                                       {
					                                           offset: 0.6,
					                                           color: '#4FADFD' // 0% 处的颜色
					                                       },
					                                       {
					                                           offset: 0.8,
					                                           color: '#0CD3DB' // 100% 处的颜色
					                                       }, {
					                                           offset: 1,
					                                           color: '#646CF9' // 100% 处的颜色
					                                       }
					                                   ]
					                               },
					                           }
					                       }
					                   },
					                   {
					                       value: 100 - value,
					                       name: "",
					                       label: {
					                           normal: {
					                               show: false
					                           }
					                       },
					                       itemStyle: {
					                           normal: {
					                               color: "#173164"
					                           }
					                       }
					                   }
					               ]
					           },
					           {
					               name: '吃猪肉频率',
					               type: 'pie',
					               radius: ['32%', '35%'],
					               silent: true,
					               clockwise: true,
					               startAngle: 270,
					               z: 0,
					               zlevel: 0,
					               label: {
					                   normal: {
					                       position: "center",
					  
					                   }
					               },
					               data: [{
					                       value: value,
					                       name: "",
					                       itemStyle: {
					                           normal: {
					                               color: { // 完成的圆环的颜色
					                                   colorStops: [{
					                                       offset: 0,
					                                       color: '#00EDF3' // 0% 处的颜色
					                                   }, {
					                                       offset: 1,
					                                       color: '#646CF9' // 100% 处的颜色
					                                   }]
					                               },
					                           }
					                       }
					                   },
					                   {
					                       value: 100 - value,
					                       name: "",
					                       label: {
					                           normal: {
					                               show: false
					                           }
					                       },
					                       itemStyle: {
					                           normal: {
					                               color: "#173164"
					                           }
					                       }
					                   }
					               ]
					           },
					  
					       ]
					   };
					  
					   //获取圆上面某点的坐标(x0,y0表示坐标，r半径，angle角度)
					   function getCirlPoint(x0, y0, r, angle) {
					       let x1 = x0 + r * Math.cos(angle * Math.PI / 180)
					       let y1 = y0 + r * Math.sin(angle * Math.PI / 180)
					       return {
					           x: x1,
					           y: y1
					       }
					   }
					  
					   function draw() {
					       angle = angle + 3
					       myChart.setOption(option, true)
					       //window.requestAnimationFrame(draw);
					   }
					   if (timerId) {
					       clearInterval(timerId);
					   }
					   timerId = setInterval(function() {
					       //用setInterval做动画感觉有问题
					       draw()
					   }, 100);
					  myChart.setOption(option);
				  },
				  setLineChart(data){ //收益走势
					  var myChart = echarts.init(document.getElementById('main'));
													
					  // mock
					  let xData = [], yData = []
					  
					  data.map(v => {
					      xData.push(v.time)
					      yData.push(v.num)
					  })
					  option = {
					      backgroundColor: 'rgba(0,0,0,.5)',
					      tooltip: {
					          trigger: 'axis',
					          axisPointer: {
					              type: 'cross',
					              label: {
					                  backgroundColor: '#6a7985',
					                  fontSize: 12
					              },
					          },
					          textStyle: { fontSize: '100%' },
					          formatter: v => {
					              return `
					                <div class='u-p-2'>
					                  <div class='fz-10'>日期：${v[0].axisValue}</div>
					                  <div class='fz-10 u-mt-2'>收益：${v[0].value}</div>
					                </div>
					              `
					          }
					      },
					     xAxis: {
					          type: 'category', boundaryGap: false, // 两边留白
					          axisLabel: { textStyle: { color: '#fff', fontSize:14}},
					          data: xData,
					          axisLine: { lineStyle: { color:'#000', width:1}},    
					          splitLine: { lineStyle: { type: 'dashed', color: 'rgba(255,255,255,.2)',width:1}, show: true },
					      },
					      yAxis:{ 
					          name:'元', type: 'value', scale: true, 
					          nameTextStyle: { color:'rgba(255,255,255,.5)', align:'right', padding:[0,10,0,0], fontSize: '100%'},
					          axisLabel: { textStyle: { color: '#fff', fontSize: '100%' }, margin: 8 }, 
					          axisLine: { lineStyle: { color:'#000', width:1 }},    
					          splitLine: { lineStyle: { type: 'solid', color: 'rgba(255,255,255,.2)',width:1 }, show: true }
					      },
					      series: {
					          name: '', type: 'line', stack: '',
					          // 修改的是线下区域的颜色
					          areaStyle: { color:  new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
					              offset: 0,
					              color: 'rgba(236, 99, 123, .5)'
					          }, {
					              offset: 1,
					              color: 'rgba(102, 212, 250,.0)'
					          }])},
					          // 修改的是线的颜色
					          lineStyle: { color: { 
					              type: 'linear',x: 0, y: 1, x2: 0, y2: 0,
					              // 0% 处的颜色                           // 100% 处的颜色
					              colorStops: [{ offset: 0, color: '#3a76f6' },{ offset: .25, color: '#66d4fa' }, { offset: .75, color: '#f8d470'}, { offset: 1, color: '#ec637b'}],
					              global: false // 缺省为 false
					          },width:2},
					          //图例样式，默认空心圆，设为none是实心，还有'circle', 'rect', 'roundRect', 'triangle', 'diamond', 'pin', 'arrow', 'none'
					          symbol:'none',  
					          data: yData,
					          markLine: {
					              symbol: 'none',
					              data: []
					          }
					      }
					  };
													
					  // 使用刚指定的配置项和数据显示图表。
					  myChart.setOption(option);
				  },
                  ACWorthTrend(list){
                      var myChart = echarts.init(document.getElementById('Data_ACWorthTrend'));
                      let x = []
                      let y = []
                      list.forEach((item)=>{
                          x.push(item.name)
                          y.push(item.value)
                      })
                      option = {
                          backgroundColor: '#394056',
                          title: {
                              text: '基金净值走势',
                              textStyle: {
                                  fontWeight: 'normal',
                                  fontSize: 16,
                                  color: '#F1F1F3'
                              },
                              left: '6%'
                          },
                          tooltip: {
                              trigger: 'axis',
                              axisPointer: {
                                  lineStyle: {
                                      color: '#57617B'
                                  }
                              }
                          },
                          legend: {
                              icon: 'rect',
                              itemWidth: 14,
                              itemHeight: 5,
                              itemGap: 13,
                              data: ['南宁-曼芭', '桂林-曼芭', '南宁-甲米'],//名称对应
                              right: '4%',
                              textStyle: {
                                  fontSize: 12,
                                  color: '#F1F1F3'
                              }
                          },
                          grid: {
                              left: '3%',
                              right: '4%',
                              bottom: '3%',
                              containLabel: true
                          },
                          xAxis: [{
                              type: 'category',
                              boundaryGap: false,
                              axisLine: {
                                  lineStyle: {
                                      color: '#57617B'
                                  }
                              },
                              data: x
                          }],
                          yAxis: [{
                              type: 'value',
                              axisTick: {
                                  show: false
                              },
                              axisLine: {
                                  lineStyle: {
                                      color: '#57617B'
                                  }
                              },
                              axisLabel: {
                                  margin: 10,
                                  textStyle: {
                                      fontSize: 14
                                  }
                              },
                              splitLine: {
                                  lineStyle: {
                                      color: '#57617B'
                                  }
                              }
                          }],
                          series: [{
                              name: '单位净值',
                              type: 'line',
                              smooth: true,
                              lineStyle: {
                                  normal: {
                                      width: 1
                                  }
                              },
                              areaStyle: {
                                  normal: {
                                      color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
                                          offset: 0,
                                          color: 'rgba(137, 189, 27, 0.3)'
                                      }, {
                                          offset: 0.8,
                                          color: 'rgba(137, 189, 27, 0)'
                                      }], false),
                                      shadowColor: 'rgba(0, 0, 0, 0.1)',
                                      shadowBlur: 10
                                  }
                              },
                              itemStyle: {
                                  normal: {
                                      color: 'rgb(137,189,27)'
                                  }
                              },
                              data: y
                          },/* {} 可多条不同样色的线*/]
                      };
                      myChart.setOption(option);
                  },
                  yearsChange(e){
                      this.assetAllocation(this.Data_assetAllocation,e)
                  },
                  assetAllocation(list,e){
                      if(!e) e = 3
                      this.yearsOption = list.categories
                      var myChart = echarts.init(document.getElementById('Data_assetAllocation'));
                      var data = [{
                          value: list.series[0].data[e].toFixed(2),
                          name: list.series[0].name
                      },{
                          value: list.series[1].data[e].toFixed(2),
                          name: list.series[1].name
                      },{
                          value: list.series[2].data[e].toFixed(2),
                          name: list.series[2].name
                      },{
                          value: list.series[3].data[e].toFixed(2),
                          name: list.series[3].name
                      }];
                      option = {
                          backgroundColor: '#fff',
                          title: {
                              text: '资产分布',
                              subtext: list.categories[e],
                              x: 'center',
                              y: 'center',
                              textStyle: {
                                  fontWeight: 'normal',
                                  fontSize: 16
                              }
                          },
                          tooltip: {
                              show: true,
                              trigger: 'item',
                              formatter: "{b}: {c} %"
                          },
                          legend: {
                              orient: 'horizontal',
                              bottom: '0%',
                              data:data.categories
                          },
                          series: [{
                              type: 'pie',
                              selectedMode: 'single',
                              radius: ['25%', '58%'],
                              color: ['#86D560', '#AF89D6', '#59ADF3', '#FF999A', '#FFCC67'],
                      
                              label: {
                                  normal: {
                                      position: 'inner',
                                      formatter: '{c}%',
                      
                                      textStyle: {
                                          color: '#fff',
                                          fontWeight: 'bold',
                                          fontSize: 14
                                      }
                                  }
                              },
                              labelLine: {
                                  normal: {
                                      show: false
                                  }
                              },
                              data: data
                          }, {
                              type: 'pie',
                              radius: ['58%', '83%'],
                              itemStyle: {
                                  normal: {
                                      color: '#F2F2F2'
                                  },
                                  emphasis: {
                                      color: '#ADADAD'
                                  }
                              },
                              label: {
                                  normal: {
                                      position: 'inner',
                                      formatter: '{b}',
                                      textStyle: {
                                          color: '#777777',
                                          fontWeight: 'bold',
                                          fontSize: 14
                                      }
                                  }
                              },
                              data: data
                          }]
                      };
                      myChart.setOption(option);
                  },
                  openLoading(text) {
                      this.loading = this.$loading({
                        lock: true,
                        text: text?text:'Loading',
                        spinner: 'el-icon-loading',
                        background: 'rgba(0, 0, 0, 0.7)'
                      });
                   },
				   getAllFundName(){//获取所有名称代码
						this.openLoading('正在加载基金代码')
					   let AllFundName = localStorage.getItem('AllFundName')
					   if(AllFundName){
						   this.fundNameOptions = JSON.parse(AllFundName).slice(0,10)
						   this.allFundName = JSON.parse(AllFundName)
						   this.loading.close();
						   return
					   }
					   axios.post(this.host+'/fund/getAllFundName')
					   .then((res)=>{
						   this.loading.close();
						   this.fundNameOptions = res.data.data.slice(0,10)
						   this.allFundName = res.data.data
						   localStorage.setItem('AllFundName',JSON.stringify(res.data.data))
					   }).catch(()=>{
						   this.loading.close();
					   })
				   },
				   elSelectChange(e){
					   let input = e.target.value
					   this.fundNameOptions = this.allFundName.filter((value, index, array)=> {
							if(value[2].indexOf(input) > -1) return value
						});
				   },
				   inputChange(input){
					   this.fundNameOptions = this.allFundName.filter((value, index, array)=> {
							if(value[0].indexOf(input) > -1) return value
						});
				   },
				   clearLocal(){
					 if (confirm("确认清除所有缓存记录？")) {
					   localStorage.clear()
					   this.$message({ showClose: true, message: '清除成功', type: 'success'});
					   setTimeout(()=>{
					   						   history.go(0) 
					   },800)
					 } else {
					 }
				   },
                   history(){
                      let history = localStorage.getItem('history')
                      this.historyData = JSON.parse(history)
                       this.showHistory = true
                   },
                   handleClick(row){
                       this.code = row.code
                       this.showHistory = false
                       this.inputChange(row.code)
                       this.fund()
                   },
                   delHistory(row){
                       let history = JSON.parse(localStorage.getItem('history'))
                       history.forEach((item,index,arr)=>{
                           if(item.time == row.time){
                               arr.splice(index,1)
                           }
                       })
                       localStorage.setItem('history',JSON.stringify(history))
                       this.historyData = history
                   },
			  },
			})
		</script>
	</body>
</html>
